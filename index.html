<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>V√≠ Web3 ƒê∆°n Gi·∫£n</title>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        input, button { margin: 5px; padding: 10px; }
        img { width: 50px; height: 50px; border-radius: 50%; }
    </style>
</head>
<body>
    <h2>V√≠ Web3 ƒê∆°n Gi·∫£n</h2>
    <button onclick="connectWallet()">üîó K·∫øt N·ªëi MetaMask</button>
    <p id="walletAddress">Ch∆∞a k·∫øt n·ªëi</p>

    <h3>üõ† Nh·∫≠p Token</h3>
    <input type="text" id="tokenAddress" placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ token">
    <input type="text" id="tokenSymbol" placeholder="Nh·∫≠p k√Ω hi·ªáu (VD: COTIEN)">
    <input type="number" id="tokenDecimals" placeholder="S·ªë th·∫≠p ph√¢n (VD: 18)">
    <input type="text" id="tokenLogo" placeholder="URL logo (t√πy ch·ªçn)">
    <button onclick="addToken()">‚ûï Nh·∫≠p Token</button>

    <h3>üí∞ S·ªë D∆∞ Token</h3>
    <img id="tokenLogoImg" src="" style="display:none;">
    <p id="tokenBalance">Ch∆∞a c√≥ d·ªØ li·ªáu</p>

    <h3>üì§ G·ª≠i Token</h3>
    <input type="text" id="receiverAddress" placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ nh·∫≠n">
    <input type="number" id="sendAmount" placeholder="Nh·∫≠p s·ªë l∆∞·ª£ng">
    <button onclick="sendToken()">üöÄ G·ª≠i Token</button>

    <script>
        let provider, signer, tokenContract, tokenDecimals, tokenSymbol;

        async function connectWallet() {
            if (!window.ethereum) {
                alert("Vui l√≤ng c√†i ƒë·∫∑t MetaMask!");
                return;
            }
            provider = new ethers.providers.Web3Provider(window.ethereum);
            await provider.send("eth_requestAccounts", []);
            signer = provider.getSigner();
            document.getElementById("walletAddress").innerText = "ƒê√£ k·∫øt n·ªëi: " + (await signer.getAddress());
        }

        async function addToken() {
            let address = document.getElementById("tokenAddress").value;
            tokenSymbol = document.getElementById("tokenSymbol").value;
            tokenDecimals = Number(document.getElementById("tokenDecimals").value);
            let logo = document.getElementById("tokenLogo").value || '';

            tokenContract = new ethers.Contract(address, [
                "function balanceOf(address owner) view returns (uint256)",
                "function transfer(address to, uint256 amount) returns (bool)"
            ], signer);

            const balance = await tokenContract.balanceOf(await signer.getAddress());
            document.getElementById("tokenBalance").innerText = `${ethers.utils.formatUnits(balance, tokenDecimals)} ${tokenSymbol}`;
            
            if (logo) {
                document.getElementById("tokenLogoImg").src = logo;
                document.getElementById("tokenLogoImg").style.display = "block";
            }
        }

        async function sendToken() {
            if (!tokenContract) {
                alert("Vui l√≤ng nh·∫≠p token tr∆∞·ªõc!");
                return;
            }
            let to = document.getElementById("receiverAddress").value;
            let amount = document.getElementById("sendAmount").value;
            let tx = await tokenContract.transfer(to, ethers.utils.parseUnits(amount, tokenDecimals));
            alert("Giao d·ªãch ƒëang ƒë∆∞·ª£c x·ª≠ l√Ω...");
            await tx.wait();
            alert("Giao d·ªãch th√†nh c√¥ng!");
        }
    </script>
</body>
</html>
