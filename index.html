<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Káº¿t Ná»‘i VÃ­ MetaMask & ThÃªm Token</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; padding: 10px; background: #222; color: white; margin: 0; }
        h1 { color: #ff9800; font-size: 24px; margin: 10px 0; }
        button { background: #ff9800; color: white; border: none; padding: 8px 16px; cursor: pointer; margin: 5px; border-radius: 4px; font-size: 14px; }
        button:hover { background: #e68a00; }
        button:disabled { background: #555; cursor: not-allowed; }
        #wallet-address { margin: 10px 0; font-size: 14px; color: #00ff00; word-break: break-all; padding: 0 10px; }
        .token { margin: 8px 0; display: flex; flex-wrap: wrap; align-items: center; justify-content: center; gap: 8px; }
        .token img { width: 24px; height: 24px; vertical-align: middle; margin-right: 5px; }
        .token a { color: #00ff00; text-decoration: none; font-size: 12px; }
        .token a:hover { text-decoration: underline; }
        .copy-btn { background: #555; font-size: 12px; padding: 4px 8px; }
        .copy-btn:hover { background: #777; }
    </style>
</head>
<body>
    <h1>Káº¿t Ná»‘i VÃ­ MetaMask & ThÃªm Token</h1>
    <button onclick="connectWallet()">ðŸ”— Káº¿t Ná»‘i MetaMask</button>
    <div id="wallet-address">ChÆ°a káº¿t ná»‘i vÃ­...</div>

    <div class="token">
        <button id="add-cot-btn" onclick="addCotienToken()" disabled><img src="https://raw.githubusercontent.com/tinizone/Logo/refs/heads/main/Cotien256.png" alt="COT"> ThÃªm Cotien (COT)</button>
        <a href="https://polygonscan.com/token/0x0d4013b4e2e2f89171bbe956da995757fb5a6678" target="_blank">Polygonscan</a>
        <button class="copy-btn" onclick="copyAddress('0x0d4013b4e2e2f89171bbe956da995757fb5a6678')">Copy</button>
    </div>
    <div class="token">
        <button id="add-pix-btn" onclick="addPixalalaToken()" disabled><img src="https://raw.githubusercontent.com/tinizone/Logo/refs/heads/main/Pi256.png" alt="PIX"> ThÃªm Pixalala (PIX)</button>
        <a href="https://polygonscan.com/token/0x1d7e521627cc4955ac8df6fe2fcb45891d0f30b7" target="_blank">Polygonscan</a>
        <button class="copy-btn" onclick="copyAddress('0x1d7e521627cc4955ac8df6fe2fcb45891d0f30b7')">Copy</button>
    </div>
    <div class="token">
        <button id="add-tin-btn" onclick="addTinizoneToken()" disabled><img src="https://raw.githubusercontent.com/tinizone/Logo/refs/heads/main/Tin256.png" alt="TIN"> ThÃªm Tinizone (TIN)</button>
        <a href="https://polygonscan.com/token/0xe7d8c8818106a565980315675d7adcb1d8ab1318" target="_blank">Polygonscan</a>
        <button class="copy-btn" onclick="copyAddress('0xe7d8c8818106a565980315675d7adcb1d8ab1318')">Copy</button>
    </div>

    <!-- ThÆ° viá»‡n ethers.js -->
    <script src="https://cdn.jsdelivr.net/npm/ethers@6.8.0/dist/ethers.umd.min.js"></script>

    <script>
        let provider, signer, account;

        // Hiá»ƒn thá»‹ user agent Ä‘á»ƒ debug
        document.getElementById("wallet-address").innerText += ` | User Agent: ${navigator.userAgent}`;

        // Kiá»ƒm tra trÃ¬nh duyá»‡t cÃ³ pháº£i lÃ  Kiwi Browser khÃ´ng
        function isKiwiBrowser() {
            const userAgent = navigator.userAgent.toLowerCase();
            // Kiá»ƒm tra chuá»—i "kiwi" hoáº·c cÃ¡c Ä‘áº·c Ä‘iá»ƒm cá»§a Kiwi Browser
            return userAgent.includes("kiwi") || (userAgent.includes("chrome") && userAgent.includes("android") && !userAgent.includes("edg") && !userAgent.includes("samsung"));
        }

        // KÃ­ch hoáº¡t nÃºt "ThÃªm Token" náº¿u lÃ  Kiwi Browser
        function enableAddTokenButtons() {
            if (isKiwiBrowser()) {
                document.getElementById("add-cot-btn").disabled = false;
                document.getElementById("add-pix-btn").disabled = false;
                document.getElementById("add-tin-btn").disabled = false;
            } else {
                document.getElementById("wallet-address").innerText += " | Vui lÃ²ng dÃ¹ng Kiwi Browser Ä‘á»ƒ thÃªm token, hoáº·c dÃ¹ng trÃ¬nh duyá»‡t MetaMask Mobile Ä‘á»ƒ thÃªm thá»§ cÃ´ng.";
            }
        }

        // Káº¿t ná»‘i vÃ­ MetaMask
        async function connectWallet() {
            try {
                if (!window.ethereum) {
                    document.getElementById("wallet-address").innerText = "âŒ MetaMask khÃ´ng Ä‘Æ°á»£c cÃ i Ä‘áº·t!";
                    return;
                }
                const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                provider = new ethers.BrowserProvider(window.ethereum);
                signer = await provider.getSigner();
                account = await signer.getAddress();
                document.getElementById("wallet-address").innerText = `âœ… ÄÃ£ káº¿t ná»‘i: ${account}`;
                await switchToPolygon();
                enableAddTokenButtons(); // Kiá»ƒm tra trÃ¬nh duyá»‡t sau khi káº¿t ná»‘i
            } catch (error) {
                document.getElementById("wallet-address").innerText = `âŒ Lá»—i káº¿t ná»‘i: ${error.message || 'KhÃ´ng rÃµ nguyÃªn nhÃ¢n'}`;
            }
        }

        // Chuyá»ƒn sang máº¡ng Polygon vá»›i symbol POL
        async function switchToPolygon() {
            try {
                await window.ethereum.request({
                    method: 'wallet_switchEthereumChain',
                    params: [{ chainId: '0x89' }]
                });
            } catch (switchError) {
                if (switchError.code === 4902) {
                    await window.ethereum.request({
                        method: 'wallet_addEthereumChain',
                        params: [{
                            chainId: '0x89',
                            chainName: 'Polygon Mainnet',
                            rpcUrls: ['https://polygon-rpc.com'],
                            nativeCurrency: { name: 'POL', symbol: 'POL', decimals: 18 },
                            blockExplorerUrls: ['https://polygonscan.com']
                        }]
                    });
                } else {
                    document.getElementById("wallet-address").innerText += ` | Lá»—i máº¡ng: ${switchError.message || 'KhÃ´ng rÃµ nguyÃªn nhÃ¢n'}`;
                }
            }
        }

        // ThÃªm token vÃ o MetaMask
        async function addToken(tokenAddress, tokenSymbol, tokenDecimals, tokenImage) {
            if (!account) {
                document.getElementById("wallet-address").innerText = "âŒ HÃ£y káº¿t ná»‘i vÃ­ MetaMask trÆ°á»›c!";
                return;
            }
            try {
                await window.ethereum.request({
                    method: 'wallet_watchAsset',
                    params: {
                        type: 'ERC20',
                        options: {
                            address: tokenAddress,
                            symbol: tokenSymbol,
                            decimals: tokenDecimals,
                            image: tokenImage
                        }
                    }
                });
                document.getElementById("wallet-address").innerText += ` | ÄÃ£ gá»­i yÃªu cáº§u thÃªm ${tokenSymbol}. Vui lÃ²ng má»Ÿ MetaMask Extension Ä‘á»ƒ xÃ¡c nháº­n.`;
            } catch (error) {
                document.getElementById("wallet-address").innerText += ` | Lá»—i thÃªm token: ${error.message || 'KhÃ´ng rÃµ nguyÃªn nhÃ¢n'}`;
            }
        }

        function addCotienToken() {
            addToken("0x0d4013b4e2e2f89171bbe956da995757fb5a6678", "COT", 18, "https://raw.githubusercontent.com/tinizone/Logo/refs/heads/main/Cotien256.png");
        }

        function addPixalalaToken() {
            addToken("0x1d7e521627cc4955ac8df6fe2fcb45891d0f30b7", "PIX", 18, "https://raw.githubusercontent.com/tinizone/Logo/refs/heads/main/Pi256.png");
        }

        function addTinizoneToken() {
            addToken("0xe7d8c8818106a565980315675d7adcb1d8ab1318", "TIN", 18, "https://raw.githubusercontent.com/tinizone/Logo/refs/heads/main/Tin256.png");
        }

        function copyAddress(address) {
            navigator.clipboard.writeText(address).then(() => {
                document.getElementById("wallet-address").innerText += " | ÄÃ£ sao chÃ©p Ä‘á»‹a chá»‰!";
            }).catch(() => {
                document.getElementById("wallet-address").innerText += " | Lá»—i sao chÃ©p!";
            });
        }
    </script>
</body>
</html>
