<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>K·∫øt N·ªëi V√≠ & Th√™m Token</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; padding: 10px; background: #222; color: white; margin: 0; }
        h1 { color: #ff9800; font-size: 24px; margin: 10px 0; }
        button { background: #ff9800; color: white; border: none; padding: 8px 16px; cursor: pointer; margin: 5px; border-radius: 4px; font-size: 14px; }
        button:hover { background: #e68a00; }
        #wallet-address { margin: 10px 0; font-size: 14px; color: #00ff00; word-break: break-all; padding: 0 10px; }
        .token { margin: 8px 0; display: flex; flex-wrap: wrap; align-items: center; justify-content: center; gap: 8px; }
        .token a { color: #00ff00; text-decoration: none; font-size: 12px; }
        .token a:hover { text-decoration: underline; }
        .copy-btn { background: #555; font-size: 12px; padding: 4px 8px; }
        .copy-btn:hover { background: #777; }
    </style>
</head>
<body>
    <h1>K·∫øt N·ªëi V√≠ & Th√™m Token</h1>
    <button onclick="connectWallet()">üîó K·∫øt N·ªëi V√≠</button>
    <div id="wallet-address">Ch∆∞a k·∫øt n·ªëi v√≠...</div>

    <div class="token">
        <button onclick="addCotienToken()">‚ûï Th√™m Cotien (COT)</button>
        <a href="https://polygonscan.com/token/0x0d4013b4e2e2f89171bbe956da995757fb5a6678" target="_blank">Polygonscan</a>
        <button class="copy-btn" onclick="copyAddress('0x0d4013b4e2e2f89171bbe956da995757fb5a6678')">Copy</button>
    </div>
    <div class="token">
        <button onclick="addPixalalaToken()">‚ûï Th√™m Pixalala (PIX)</button>
        <a href="https://polygonscan.com/token/0x1d7e521627cc4955ac8df6fe2fcb45891d0f30b7" target="_blank">Polygonscan</a>
        <button class="copy-btn" onclick="copyAddress('0x1d7e521627cc4955ac8df6fe2fcb45891d0f30b7')">Copy</button>
    </div>
    <div class="token">
        <button onclick="addTinizoneToken()">‚ûï Th√™m Tinizone (TIN)</button>
        <a href="https://polygonscan.com/token/0xe7d8c8818106a565980315675d7adcb1d8ab1318" target="_blank">Polygonscan</a>
        <button class="copy-btn" onclick="copyAddress('0xe7d8c8818106a565980315675d7adcb1d8ab1318')">Copy</button>
    </div>

    <!-- Th∆∞ vi·ªán ethers.js -->
    <script src="https://cdn.jsdelivr.net/npm/ethers@6.8.0/dist/ethers.umd.min.js"></script>
    <!-- Web3Modal v·ªõi CDN ch√≠nh v√† fallback -->
    <script src="https://cdn.jsdelivr.net/npm/@web3modal/ethers@3.5.4/dist/index.js" id="web3modal-script" onload="onWeb3ModalLoaded()" onerror="loadWeb3ModalFallback()"></script>

    <script>
        let provider, signer, account, modal;

        // X·ª≠ l√Ω khi Web3Modal t·∫£i th√†nh c√¥ng
        function onWeb3ModalLoaded() {
            try {
                if (!window.Web3Modal) {
                    throw new Error("Th∆∞ vi·ªán Web3Modal kh√¥ng kh·∫£ d·ª•ng sau khi t·∫£i t·ª´ CDN ch√≠nh.");
                }
                modal = new window.Web3Modal.default({
                    projectId: "71ea15e324540c729b0528f5e9df30f3",
                    walletConnectVersion: 2,
                    chains: [{
                        chainId: "0x89",
                        chainName: "Polygon Mainnet",
                        rpcUrls: ["https://polygon-rpc.com"],
                        nativeCurrency: { name: "MATIC", symbol: "MATIC", decimals: 18 },
                        blockExplorerUrls: ["https://polygonscan.com"]
                    }]
                });
                alert("Th∆∞ vi·ªán Web3Modal ƒë√£ t·∫£i th√†nh c√¥ng. Nh·∫•n 'K·∫øt N·ªëi V√≠' ƒë·ªÉ ti·∫øp t·ª•c.");
            } catch (error) {
                alert("‚ö†Ô∏è L·ªói kh·ªüi t·∫°o Web3Modal: " + (error.message || "Kh√¥ng r√µ nguy√™n nh√¢n."));
            }
        }

        // Fallback n·∫øu CDN ch√≠nh th·∫•t b·∫°i
        function loadWeb3ModalFallback() {
            const fallbackScript = document.createElement('script');
            fallbackScript.src = "https://unpkg.com/@web3modal/ethers@3.5.4/dist/index.js";
            fallbackScript.onload = onWeb3ModalLoaded;
            fallbackScript.onerror = () => {
                alert("‚ö†Ô∏è L·ªói t·∫£i th∆∞ vi·ªán Web3Modal t·ª´ c·∫£ hai CDN. Ki·ªÉm tra k·∫øt n·ªëi internet ho·∫∑c li√™n h·ªá h·ªó tr·ª£.");
            };
            document.body.appendChild(fallbackScript);
        }

        async function connectWallet() {
            try {
                if (!modal) {
                    throw new Error("Web3Modal ch∆∞a ƒë∆∞·ª£c kh·ªüi t·∫°o. Th∆∞ vi·ªán ch∆∞a t·∫£i ho·∫∑c Project ID kh√¥ng h·ª£p l·ªá.");
                }
                const instance = await modal.connect();
                if (!instance) throw new Error("Kh√¥ng nh·∫≠n ƒë∆∞·ª£c provider t·ª´ WalletConnect.");
                provider = new ethers.BrowserProvider(instance);
                signer = await provider.getSigner();
                account = await signer.getAddress();
                document.getElementById("wallet-address").innerText = `‚úÖ ƒê√£ k·∫øt n·ªëi: ${account}`;
                await switchToPolygon();
            } catch (error) {
                let errorMsg = "‚ö†Ô∏è L·ªói k·∫øt n·ªëi v√≠: ";
                if (error.code === "USER_REJECTED_REQUEST") errorMsg += "B·∫°n ƒë√£ t·ª´ ch·ªëi k·∫øt n·ªëi.";
                else if (error.code === "INVALID_PROJECT_ID") errorMsg += "Project ID kh√¥ng h·ª£p l·ªá. Ki·ªÉm tra l·∫°i tr√™n WalletConnect Cloud.";
                else if (error.message) errorMsg += error.message;
                else errorMsg += "Kh√¥ng r√µ nguy√™n nh√¢n. ƒê·∫£m b·∫£o b·∫°n c√≥ v√≠ nh∆∞ MetaMask/Trust Wallet v√† k·∫øt n·ªëi internet.";
                alert(errorMsg);
            }
        }

        async function switchToPolygon() {
            try {
                await provider.send("wallet_switchEthereumChain", [{ chainId: "0x89" }]);
            } catch (switchError) {
                if (switchError.code === 4902) {
                    await provider.send("wallet_addEthereumChain", [{
                        chainId: "0x89",
                        chainName: "Polygon Mainnet",
                        rpcUrls: ["https://polygon-rpc.com"],
                        nativeCurrency: { name: "MATIC", symbol: "MATIC", decimals: 18 },
                        blockExplorerUrls: ["https://polygonscan.com"]
                    }]);
                } else {
                    alert("‚ö†Ô∏è L·ªói chuy·ªÉn m·∫°ng: " + (switchError.message || "Kh√¥ng r√µ nguy√™n nh√¢n."));
                }
            }
        }

        async function addToken(tokenAddress, tokenSymbol, tokenDecimals, tokenImage) {
            if (!account) {
                alert("‚ö†Ô∏è H√£y k·∫øt n·ªëi v√≠ tr∆∞·ªõc!");
                return;
            }
            try {
                const wasAdded = await provider.send("wallet_watchAsset", {
                    type: "ERC20",
                    options: { 
                        address: tokenAddress, 
                        symbol: tokenSymbol, 
                        decimals: tokenDecimals, 
                        image: tokenImage 
                    }
                });
                if (wasAdded) alert(`‚úÖ ${tokenSymbol} ƒë√£ ƒë∆∞·ª£c th√™m!`);
                else alert(`‚ùå B·∫°n ƒë√£ t·ª´ ch·ªëi th√™m ${tokenSymbol}.`);
            } catch (error) {
                alert("‚ö†Ô∏è L·ªói khi th√™m token: " + (error.message || "Kh√¥ng r√µ nguy√™n nh√¢n."));
            }
        }

        function addCotienToken() {
            addToken("0x0d4013b4e2e2f89171bbe956da995757fb5a6678", "COT", 18, "https://raw.githubusercontent.com/tinizone/Logo/refs/heads/main/Cotien256.png");
        }

        function addPixalalaToken() {
            addToken("0x1d7e521627cc4955ac8df6fe2fcb45891d0f30b7", "PIX", 18, "https://raw.githubusercontent.com/tinizone/Logo/refs/heads/main/Pi256.png");
        }

        function addTinizoneToken() {
            addToken("0xe7d8c8818106a565980315675d7adcb1d8ab1318", "TIN", 18, "https://raw.githubusercontent.com/tinizone/Logo/refs/heads/main/Tin256.png");
        }

        function copyAddress(address) {
            navigator.clipboard.writeText(address).then(() => {
                alert("‚úÖ ƒê√£ sao ch√©p ƒë·ªãa ch·ªâ: " + address);
            }).catch(err => {
                alert("‚ö†Ô∏è L·ªói khi sao ch√©p: " + (err.message || "Kh√¥ng r√µ nguy√™n nh√¢n."));
            });
        }
    </script>
</body>
</html>
