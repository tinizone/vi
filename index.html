<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>K·∫øt N·ªëi V√≠ & Th√™m Token</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; padding: 20px; background-color: #222; color: white; }
        h1 { color: #ff9800; }
        button { background-color: #ff9800; color: white; border: none; padding: 10px 20px; cursor: pointer; margin: 10px; }
        button:hover { background-color: #e68a00; }
        #wallet-address { margin-top: 10px; font-size: 16px; color: #00ff00; }
    </style>
</head>
<body>
    <h1>K·∫øt N·ªëi V√≠ & Th√™m Token</h1>
    <button onclick="connectWallet()">üîó K·∫øt N·ªëi V√≠</button>
    <button onclick="addCotienToken()">‚ûï Th√™m Cotien (COT)</button>
    <button onclick="addPixalalaToken()">‚ûï Th√™m Pixalala (PIX)</button>
    <button onclick="addTinizoneToken()">‚ûï Th√™m Tinizone (TIN)</button>
    <div id="wallet-address">Ch∆∞a k·∫øt n·ªëi v√≠...</div>

    <!-- Th∆∞ vi·ªán ethers.js -->
    <script src="https://cdn.jsdelivr.net/npm/ethers@6.8.0/dist/ethers.umd.min.js"></script>
    <!-- Web3Modal v3 -->
    <script src="https://unpkg.com/@web3modal/html@3.3.0"></script>

    <script>
        let provider, signer, account;

        async function connectWallet() {
            try {
                const modal = new web3modal.createWeb3Modal({
                    projectId: "71ea15e324540c729b0528f5e9df30f3", // WalletConnect Project ID
                    walletConnectVersion: 2
                });

                const instance = await modal.openModal();
                provider = new ethers.BrowserProvider(instance);
                signer = await provider.getSigner();
                account = await signer.getAddress();
                document.getElementById("wallet-address").innerText = `‚úÖ ƒê√£ k·∫øt n·ªëi: ${account}`;

                await switchToPolygon(); // Chuy·ªÉn sang m·∫°ng Polygon n·∫øu ch∆∞a ƒë√∫ng

            } catch (error) {
                console.error("L·ªói k·∫øt n·ªëi v√≠:", error);
                alert("‚ö†Ô∏è L·ªói k·∫øt n·ªëi v√≠! H√£y th·ª≠ l·∫°i.");
            }
        }

        async function switchToPolygon() {
            try {
                await provider.send("wallet_switchEthereumChain", [{ chainId: "0x89" }]); // Polygon Mainnet
            } catch (switchError) {
                if (switchError.code === 4902) { // N·∫øu m·∫°ng ch∆∞a c√≥, th√™m v√†o
                    await provider.send("wallet_addEthereumChain", [{
                        chainId: "0x89",
                        chainName: "Polygon Mainnet",
                        rpcUrls: ["https://polygon-rpc.com"],
                        nativeCurrency: { name: "MATIC", symbol: "MATIC", decimals: 18 },
                        blockExplorerUrls: ["https://polygonscan.com"]
                    }]);
                } else {
                    console.error("L·ªói chuy·ªÉn m·∫°ng:", switchError);
                    alert("‚ö†Ô∏è Kh√¥ng th·ªÉ chuy·ªÉn sang Polygon.");
                }
            }
        }

        async function addToken(tokenAddress, tokenSymbol, tokenDecimals) {
            if (!account) {
                alert("‚ö†Ô∏è H√£y k·∫øt n·ªëi v√≠ tr∆∞·ªõc!");
                return;
            }
            try {
                const wasAdded = await provider.send("wallet_watchAsset", {
                    type: 'ERC20',
                    options: { address: tokenAddress, symbol: tokenSymbol, decimals: tokenDecimals }
                });
                if (wasAdded) {
                    alert(`‚úÖ ${tokenSymbol} ƒë√£ ƒë∆∞·ª£c th√™m v√†o v√≠!`);
                } else {
                    alert(`‚ùå Ng∆∞·ªùi d√πng t·ª´ ch·ªëi th√™m ${tokenSymbol}.`);
                }
            } catch (error) {
                console.error("L·ªói th√™m token:", error);
                alert("‚ö†Ô∏è L·ªói khi th√™m token! H√£y th·ª≠ l·∫°i.");
            }
        }

        function addCotienToken() { addToken("0x0d4013b4e2e2f89171bbe956da995757fb5a6678", "COT", 18); }
        function addPixalalaToken() { addToken("0x1d7e521627cc4955ac8df6fe2fcb45891d0f30b7", "PIX", 18); }
        function addTinizoneToken() { addToken("0xe7d8c8818106a565980315675d7adcb1d8ab1318", "TIN", 18); }
    </script>
</body>
</html>
